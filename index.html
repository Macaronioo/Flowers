<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>èŠ±ç“£è¨ˆç®—å™¨</title>

<style>
body {
    font-family: Arial, sans-serif;
    padding: 10px;
    background: #fafafa;
}
.group-title {
    font-size: 20px;
    margin-top: 20px;
    font-weight: bold;
}
.flower-row {
    background: white;
    padding: 10px;
    margin: 8px 0;
    border-radius: 8px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.12);
}
.completed {
    background: #e0ffe0;
}
.row-top {
    font-weight: bold;
    margin-bottom: 6px;
}
.input-box {
    width: 70px;
}
.small-label {
    font-size: 14px;
    opacity: 0.7;
}
.hidden {
    display: none;
}
.series-completed {
    font-size: 20px;
    color: green;
    font-weight: bold;
    margin-top: 15px;
}
</style>
</head>

<body>

<h2>ğŸŒ¸ èŠ±ç“£è¨ˆç®—å™¨</h2>

<!-- ================= æ«»è‰èŠ±ç³»åˆ— ================= -->
<div id="primrose-section">
    <div class="group-title">æ«»è‰èŠ±ç³»åˆ—</div>
    <div id="primrose-rows"></div>
</div>

<!-- ================= è–èª•ç´…ç³»åˆ— ================= -->
<div id="poinsettia-section">
    <div class="group-title">è–èª•ç´…ç³»åˆ—</div>
    <div id="poinsettia-rows"></div>
</div>

<script>
/*=====================
     è³‡æ–™è¨­å®š
=====================*/

const primrose = [
    {name:"ç™½è‰²æ«»è‰èŠ±", need:2000, color:true},
    {name:"é»ƒè‰²æ«»è‰èŠ±", need:2000, color:true},
    {name:"è—è‰²æ«»è‰èŠ±", need:2000, color:true},
    {name:"ç´…è‰²æ«»è‰èŠ±", need:2000, color:true},
    {name:"æ«»è‰èŠ±", need:500, color:false}
];

const poinsettia = [
    {name:"ç™½è‰²è–èª•ç´…", need:1500, color:true},
    {name:"ç´…è‰²è–èª•ç´…", need:1500, color:true},
    {name:"é»ƒè‰²è–èª•ç´…", need:1500, color:true},
    {name:"è—è‰²è–èª•ç´…", need:1000, color:true},
    {name:"è–èª•ç´…", need:2500, color:false}
];

/*=====================
     å»ºç«‹ä»‹é¢
=====================*/

function createRows(list, targetID, groupName) {
    const container = document.getElementById(targetID);
    container.innerHTML = "";

    list.forEach((f, index)=>{
        const row = document.createElement("div");
        row.className = "flower-row";
        row.id = groupName + "-row-" + index;

        row.innerHTML = `
            <div class="row-top" id="${groupName}-title-${index}">
                ${f.name}
            </div>
            <div id="${groupName}-inputs-${index}">
                éœ€ç¨®ï¼š${f.need} ï½œ 
                å·²ç¨®ï¼š<input class="input-box" id="${groupName}-planted-${index}" type="number" min="0" value="0"><br>
                å°šéœ€ç¨®ï¼š<span id="${groupName}-remain-${index}">0</span><br>
                æ‰€éœ€èŠ±ç“£ï¼š<span id="${groupName}-petalNeed-${index}">0</span><br>
                ${f.color ?
                    `å·²æœ‰èŠ±ç“£ï¼š<input class="input-box" id="${groupName}-petalHave-${index}" type="number" min="0" value="0">`
                 :
                    `å·²æœ‰èŠ±ç“£(è‡ªå‹•)ï¼š<span id="${groupName}-petalHave-${index}">0</span>`
                }<br>
                å°šéœ€èŠ±ç“£ï¼š<span id="${groupName}-petalRemain-${index}">0</span>
            </div>
        `;
        container.appendChild(row);
    });
}

/*=====================
       è¨ˆç®—å‡½å¼
=====================*/

function calculateGroup(list, groupName) {

    let extraPetals = 0; // æœ‰è‰²èŠ±çš„å¤šé¤˜èŠ±ç“£åŠ ç¸½

    // ç¬¬ä¸€è¼ªï¼šè™•ç†æœ‰è‰²èŠ±è¨ˆç®—
    list.forEach((f, i)=>{
        const need = f.need;
        const planted = Number(document.getElementById(`${groupName}-planted-${i}`).value || 0);
        
        const remain = Math.max(need - planted, 0);
        document.getElementById(`${groupName}-remain-${i}`).innerText = remain;

        const petalNeed = Math.ceil(remain / 15);
        document.getElementById(`${groupName}-petalNeed-${i}`).innerText = petalNeed;

        let petalHave;

        if (f.color) {
            petalHave = Number(document.getElementById(`${groupName}-petalHave-${i}`).value || 0);
        } else {
            petalHave = 0; // æš«æ™‚ï¼Œç­‰å…¨éƒ¨ç´¯ç©å®Œå†å¡å€¼
        }

        let petalRemain = petalNeed - petalHave;
        petalRemain = Math.max(petalRemain, 0);
        document.getElementById(`${groupName}-petalRemain-${i}`).innerText = petalRemain;

        // è¨ˆç®—å¤šé¤˜èŠ±ç“£
        if (f.color) {
            const extra = Math.max(petalHave - petalNeed, 0);
            extraPetals += extra;
        }
    });

    // ç¬¬äºŒè¼ªï¼šè™•ç†ç„¡è‰²èŠ±èŠ±ç“£åŠ ç¸½
    const lastIndex = list.length - 1;
    const pure = list[lastIndex];

    const remainPure = Number(document.getElementById(`${groupName}-remain-${lastIndex}`).innerText);
    const needPetalPure = Math.ceil(remainPure / 15);

    document.getElementById(`${groupName}-petalHave-${lastIndex}`).innerText = extraPetals;

    const remainPetalPure = Math.max(needPetalPure - extraPetals, 0);
    document.getElementById(`${groupName}-petalRemain-${lastIndex}`).innerText = remainPetalPure;

    // æª¢æŸ¥ç³»åˆ—å®Œæˆ
    if (remainPure === 0 && remainPetalPure === 0) {
        // æ•´ç³»åˆ—å®Œæˆ
        const section = document.getElementById(groupName + "-rows");
        section.innerHTML = `<div class="series-completed">${list[0].name.replace("ç™½è‰²","").replace(" ","")}ç³»åˆ—ï¼å®Œæˆï¼</div>`;
    } else {
        // æ²’å®Œæˆ â†’ æ›´æ–°å®Œæˆç‹€æ…‹é¡¯ç¤º
        list.forEach((f, i)=>{
            const remain = Number(document.getElementById(`${groupName}-remain-${i}`).innerText);
            const row = document.getElementById(`${groupName}-row-${i}`);
            const title = document.getElementById(`${groupName}-title-${i}`);
            const inputArea = document.getElementById(`${groupName}-inputs-${i}`);

            if (remain === 0) {
                row.classList.add("completed");
                title.innerText = `${f.name}ï¼å®Œæˆï¼`;
            } else {
                row.classList.remove("completed");
                title.innerText = f.name;
            }
        });
    }
}

/*=====================
  äº‹ä»¶ç¶å®šï¼†åˆå§‹åŒ–
=====================*/

function bindEvents(list, groupName) {
    list.forEach((f, i)=>{
        const ids = [
            `${groupName}-planted-${i}`,
            `${groupName}-petalHave-${i}`
        ];

        ids.forEach(id=>{
            const el = document.getElementById(id);
            if (el) {
                el.addEventListener("input", ()=>calculateGroup(list, groupName));
            }
        });
    });
}

createRows(primrose, "primrose-rows", "primrose");
createRows(poinsettia, "poinsettia-rows", "poinsettia");

bindEvents(primrose, "primrose");
bindEvents(poinsettia, "poinsettia");

calculateGroup(primrose, "primrose");
calculateGroup(poinsettia, "poinsettia");

</script>

</body>
</html>
